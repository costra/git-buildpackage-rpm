<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Importing Sources</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Building Debian Packages with git-buildpackage"
HREF="gbp.html"><LINK
REL="PREVIOUS"
TITLE="Introduction"
HREF="gbp.intro.html"><LINK
REL="NEXT"
TITLE="Building packages from the Git repository"
HREF="gbp.building.html"><STYLE
TYPE="text/css"
>.synopsis, .classsynopsis {
    background: #eeeeee;
    border: solid 1px #aaaaaa;
    padding: 0.5em;
}
.programlisting {
    background: #eeeeff;
    border: solid 1px #aaaaff;
    padding: 0.5em;
}
.variablelist {
    padding: 4px;
    margin-left: 3em;
}
.navigation {
    background: #ffeeee;
    border: solid 1px #ffaaaa;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}
.navigation a {
    color: #770000;
}
.navigation a:visited {
    color: #550000;
}
.navigation .title {
    font-size: 200%;
}</STYLE
></HEAD
><BODY
CLASS="CHAPTER"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><TABLE
WIDTH="100%"
CLASS="navigation"
SUMMARY="Navigation header"
CELLPADDING="2"
CELLSPACING="2"
><TR
VALIGN="middle"
><TD
><A
ACCESSKEY="p"
HREF="gbp.intro.html"
><IMG
SRC="left.png"
WIDTH="24"
HEIGHT="24"
BORDER="0"
ALT="Prev"></A
></TD
><TD
><A
ACCESSKEY="h"
HREF="gbp.html"
><IMG
SRC="home.png"
WIDTH="24"
HEIGHT="24"
BORDER="0"
ALT="Home"></A
></TD
><TH
WIDTH="100%"
align="center"
>Building Debian Packages with git-buildpackage: Version: </TH
><TD
><A
ACCESSKEY="n"
HREF="gbp.building.html"
><IMG
SRC="right.png"
WIDTH="24"
HEIGHT="24"
BORDER="0"
ALT="Next"></A
></TD
></TR
></TABLE
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="GBP.IMPORT"
></A
>Importing Sources</H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
><A
HREF="gbp.import.html#GBP.IMPORT.EXISTING"
>Importing already existing <SPAN
CLASS="PRODUCTNAME"
>Debian</SPAN
> packages</A
></DT
><DT
><A
HREF="gbp.import.html#GBP.IMPORT.NEW.UPSTREAM"
>Importing a new upstream version</A
></DT
><DT
><A
HREF="gbp.import.html#GBP.IMPORT.CONVERT"
>Converting an existing <SPAN
CLASS="PRODUCTNAME"
>Git</SPAN
> repository</A
></DT
><DT
><A
HREF="gbp.import.html#GBP.IMPORT.FROMSCRATCH"
>Starting a Debian package from scratch</A
></DT
><DT
><A
HREF="gbp.import.html#GBP.IMPORT.UPSTREAM-GIT"
>When upstream uses GIT</A
></DT
></DL
></DIV
><BR
CLEAR="all"><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GBP.IMPORT.EXISTING"
>Importing already existing <SPAN
CLASS="PRODUCTNAME"
>Debian</SPAN
> packages</A
></H1
><P
>Importing an already exsting debian package into a git repository is as easy as:
    <PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>git-import-dsc</B
> package_0.1-1.dsc
    </PRE
>
    This will create a new git repository named after the imported package, put
    the upstream sources onto the <CODE
CLASS="OPTION"
>upstream-branch</CODE
> and the
    debian patch on the <CODE
CLASS="OPTION"
>debian-branch</CODE
>. In case of a debian
    native package only the <CODE
CLASS="OPTION"
>debian-branch</CODE
> is being used.
    You can specify alternative branch names via the
    <CODE
CLASS="OPTION"
>--upstream-branch</CODE
> and <CODE
CLASS="OPTION"
>--debian-branch</CODE
>
    options or via the <CODE
CLASS="OPTION"
>upstream-branch</CODE
> and
    <CODE
CLASS="OPTION"
>debian-branch</CODE
> options in the configuration file.
    </P
><P
>    If you want to be able to exactly recreate the original tarball
    (orig.tar.gz) from <SPAN
CLASS="PRODUCTNAME"
>Git</SPAN
> you should also specify the
    <CODE
CLASS="OPTION"
>--pristine-tar</CODE
> option.  This is recommended.
    </P
><P
>    If you want to import further versions you can change into your shiny new
    <SPAN
CLASS="PRODUCTNAME"
>Git</SPAN
> repository and just continue with the same command:
    <PRE
CLASS="SCREEN"
>cd package/
<B
CLASS="COMMAND"
>git-import-dsc</B
> package_0.1-2.dsc
<B
CLASS="COMMAND"
>git-import-dsc</B
> package_0.1-3.dsc
<B
CLASS="COMMAND"
>git-import-dsc</B
> package_0.2-1.dsc
    </PRE
>
    </P
><P
>Or you can import all versions at once using <B
CLASS="COMMAND"
>git-import-dscs</B
>:
    <PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>git-import-dscs</B
> /path/to/history/package_*.dsc
    </PRE
>
This will create a <SPAN
CLASS="PRODUCTNAME"
>Git</SPAN
> repository if necessary and import all versions sorted
by version number.
    </P
></DIV
><BR
CLEAR="all"><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GBP.IMPORT.NEW.UPSTREAM"
>Importing a new upstream version</A
></H1
><P
>Change into your git repository (which can be empty), make sure it
    has all local modifications committed and run either of:
    <PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>git-import-orig</B
> <TT
CLASS="FILENAME"
>/path/to/package_0.2.orig.tar.gz</TT
>
<B
CLASS="COMMAND"
>git-import-orig</B
> <TT
CLASS="FILENAME"
>/path/to/package_0.2.tar.bz2</TT
>
<B
CLASS="COMMAND"
>git-import-orig</B
> <TT
CLASS="FILENAME"
>/path/to/package-0.2/</TT
>
    </PRE
>
    This puts the upstream souces onto the <CODE
CLASS="OPTION"
>upstream-branch</CODE
> and
    tags them accordingly (the default tag format is
    <TT
CLASS="REPLACEABLE"
><I
>upstream/%(version)s</I
></TT
>).
    The result is then merged onto the <CODE
CLASS="OPTION"
>debian-branch</CODE
>
    and a new <SPAN
CLASS="PRODUCTNAME"
>Debian</SPAN
> changelog entry is created. You can again specify
    different branch names via the <CODE
CLASS="OPTION"
>--upstream-branch</CODE
> and
    <CODE
CLASS="OPTION"
>--debian-branch</CODE
> options. You can also filter out content
    you don't want imported:
    <PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>git-import-orig</B
> <CODE
CLASS="OPTION"
>--filter</CODE
>=<TT
CLASS="REPLACEABLE"
><I
>'CVS/*'</I
></TT
> <TT
CLASS="FILENAME"
>/path/to/package_0.2.orig.tar.gz</TT
>
    </PRE
>
    The <CODE
CLASS="OPTION"
>--filter</CODE
> option can be used multiple times for more
    complex filtering.
    </P
><P
>    If you expect a merge conflict you can delay the merge to the
    <CODE
CLASS="OPTION"
>debian-branch</CODE
> via the <CODE
CLASS="OPTION"
>--no-merge</CODE
> and pull in
    the changes from the <CODE
CLASS="OPTION"
>upstream-branch</CODE
> later.
    </P
><P
>    If you want to be able to exactly recreate the original tarball
    (orig.tar.gz) from <SPAN
CLASS="PRODUCTNAME"
>Git</SPAN
> you should also specify the
    <CODE
CLASS="OPTION"
>--pristine-tar</CODE
> option.  This is recommended.
    </P
><P
>To customize the commit message used by <B
CLASS="COMMAND"
>git-import-orig</B
> use
    the <CODE
CLASS="OPTION"
>--import-msg</CODE
> option. This string is a standard
    python format string, into which the
    <TT
CLASS="REPLACEABLE"
><I
>version</I
></TT
> variable is interpolated. (i.e.,
    use <TT
CLASS="REPLACEABLE"
><I
>%(version)s</I
></TT
> in your message to get
    the imported upstream version).
    </P
></DIV
><BR
CLEAR="all"><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GBP.IMPORT.CONVERT"
>Converting an existing <SPAN
CLASS="PRODUCTNAME"
>Git</SPAN
> repository</A
></H1
><P
>    If the <SPAN
CLASS="PRODUCTNAME"
>Git</SPAN
> repository wasn't created with <B
CLASS="COMMAND"
>git-import-dsc</B
> you have to tell
    <B
CLASS="COMMAND"
>git-buildpackage</B
> and friends where to find the upstream sources.
    </P
><BR
CLEAR="all"><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN195"
>Upstream sources on a branch</A
></H2
><P
>    If the upstream sources are already on a separate branch things are pretty
    simple. You can either rename that branch to the default
    <CODE
CLASS="OPTION"
>upstream-branch</CODE
> name <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>upstream</I
></SPAN
> with:
    <PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>git</B
> branch upstream theupstream-branch
<B
CLASS="COMMAND"
>git</B
> branch <CODE
CLASS="OPTION"
>-D</CODE
> theupstream-branch
    </PRE
>
    or you can tell <B
CLASS="COMMAND"
>git-buildpackage</B
> the name of the branch to use as
    <CODE
CLASS="OPTION"
>upstream-branch</CODE
>:
    <PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>cat</B
> &lt;&lt;EOF &gt; <TT
CLASS="FILENAME"
>.git/gbp.conf</TT
>
[DEFAULT]
# this is the upstream-branch:
upstream-branch=theupstream-branch
EOF
    </PRE
>
    If you then use <B
CLASS="COMMAND"
>git-import-orig</B
> to import new upstream sources, they will
    from now on end up on <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>theupstream-branch</I
></SPAN
> and
    merged to the <CODE
CLASS="OPTION"
>debian-branch</CODE
>.
    </P
></DIV
><BR
CLEAR="all"><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN212"
>Upstream sources not on a branch</A
></H2
><P
>    If you don't have an upstream branch but started your repository with only
    the upstream sources (not the debian patch) you can simply branch from that
    point. So use <B
CLASS="COMMAND"
>gitk</B
> or <B
CLASS="COMMAND"
>git</B
>-log to locate the commit-id of that commit
    and create the upstream branch from there, e.g.:
<PRE
CLASS="SCREEN"
>    COMMIT_ID=`<B
CLASS="COMMAND"
>git</B
> log --pretty=oneline | tail -1 | awk '{ print $1 }'`
    <B
CLASS="COMMAND"
>git</B
> branch upstream $COMMIT_ID</PRE
>
    The important thing here is that the <CODE
CLASS="ENVAR"
>COMMIT_ID</CODE
> specifies a
    point on the master branch that carried <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>only</I
></SPAN
> the
    upstream sources and not the debian modifications. The above example
    assumes that this was the first commit to that repository.
    </P
><DIV
CLASS="WARNING"
><P
></P
><TABLE
CLASS="WARNING"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>Warning</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
>There's currently no <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>easy</I
></SPAN
> way to create the
    <CODE
CLASS="OPTION"
>upstream-branch</CODE
> if you never had the upstream sources
    as a single commit. Using <B
CLASS="COMMAND"
>git-import-orig</B
> on such repositories might lead
    to unexpected merge results.</P
></TD
></TR
></TABLE
></DIV
><P
>In order to fix this you can prepend the upstream sources as a
    single commit to your tree using <SPAN
CLASS="PRODUCTNAME"
>Git</SPAN
>'s <A
HREF="http://git.or.cz/gitwiki/GraftPoint"
TARGET="_top"
>grafts</A
>. Afterwards you
    can simply create a branch as explained above and <B
CLASS="COMMAND"
>git-import-orig</B
> will
    work as expected.</P
><P
>Alternatively, if you are only importing source from original tarballs
    (for instance when converting from a Subversion repository where the
    mergeWithUpstream was set for svn-buildpackage), you can create an empty
    upstream branch with the following commands:
<PRE
CLASS="SCREEN"
>    <B
CLASS="COMMAND"
>git checkout</B
> <CODE
CLASS="OPTION"
>--orphan</CODE
> <TT
CLASS="REPLACEABLE"
><I
>upstream</I
></TT
>
    <B
CLASS="COMMAND"
>git rm</B
> <CODE
CLASS="OPTION"
>-rf</CODE
> <TT
CLASS="REPLACEABLE"
><I
>.</I
></TT
>
    <B
CLASS="COMMAND"
>git commit</B
> <CODE
CLASS="OPTION"
>--allow-empty</CODE
> <CODE
CLASS="OPTION"
>-m</CODE
> <TT
CLASS="REPLACEABLE"
><I
>'Initial upstream branch.'</I
></TT
>
    <B
CLASS="COMMAND"
>git checkout</B
> <CODE
CLASS="OPTION"
>-f</CODE
> <TT
CLASS="REPLACEABLE"
><I
>master</I
></TT
></PRE
>
    With Git versions lower than 1.7.2.3, the commands are slightly more complicated:
<PRE
CLASS="SCREEN"
>    <B
CLASS="COMMAND"
>git symbolic-ref</B
> <TT
CLASS="REPLACEABLE"
><I
>HEAD</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>refs/heads/upstream</I
></TT
>
    <B
CLASS="COMMAND"
>git rm</B
> <CODE
CLASS="OPTION"
>--cached</CODE
> <CODE
CLASS="OPTION"
>-r</CODE
> <TT
CLASS="REPLACEABLE"
><I
>.</I
></TT
>
    <B
CLASS="COMMAND"
>git commit</B
> <CODE
CLASS="OPTION"
>--allow-empty</CODE
> <CODE
CLASS="OPTION"
>-m</CODE
> <TT
CLASS="REPLACEABLE"
><I
>'Initial upstream branch.'</I
></TT
>
    <B
CLASS="COMMAND"
>git checkout</B
> <CODE
CLASS="OPTION"
>-f</CODE
> <TT
CLASS="REPLACEABLE"
><I
>master</I
></TT
></PRE
>
    </P
></DIV
></DIV
><BR
CLEAR="all"><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GBP.IMPORT.FROMSCRATCH"
>Starting a Debian package from scratch</A
></H1
><P
>    So far we assumed you already have a <SPAN
CLASS="PRODUCTNAME"
>Debian</SPAN
> package to start with but
    what if you want to start a new package? First create an empty repository:
    </P
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>mkdir</B
> package-0.1
<B
CLASS="COMMAND"
>cd</B
> package-0.1
<B
CLASS="COMMAND"
>git init</B
>
    </PRE
><P
>Then you import the upstream sources, branch off the
    <CODE
CLASS="OPTION"
>upstream-branch</CODE
> branch and add the debian files (e.g. via dh_make):
    <PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>git-import-orig</B
> <CODE
CLASS="OPTION"
>-u</CODE
> <TT
CLASS="REPLACEABLE"
><I
>0.1</I
></TT
> <TT
CLASS="FILENAME"
>../package-0.1.tar.gz</TT
>
<B
CLASS="COMMAND"
>dh_make</B
>
    </PRE
>
    That's it, you're done. If you want to publish you're new repository you can use <B
CLASS="COMMAND"
>gbp-create-remote-repo</B
>.
    </P
></DIV
><BR
CLEAR="all"><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GBP.IMPORT.UPSTREAM-GIT"
>When upstream uses GIT</A
></H1
><P
>      If upstream already uses git for packaging there are several ways to handle packaging. Two will
      be described in a bit detail here:
    </P
><BR
CLEAR="all"><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="GBP.IMPORT.UPSTREAM.GIT.NOTARBALL"
>No upstream tarballs</A
></H2
><P
>If upstream doesn't build upstream tarballs or you don't care about them the simplest
	  way is to clone upstreams repository and create a separate packaging branch in there.
	</P
><P
>	  <B
CLASS="COMMAND"
>git-buildpackage</B
> will by default create an upstream tarball for you. By default it will
	  be created from the tag name given by the <CODE
CLASS="OPTION"
>--git-upstream-tag</CODE
> option.
	  You can customize it's value via the <CODE
CLASS="OPTION"
>upstream-tag</CODE
> configuration variable.
	</P
><P
>	  A common upstream format is to put a <TT
CLASS="REPLACEABLE"
><I
>v</I
></TT
> in front of the version number.
	  In this case the configuration option would look like:
	</P
><PRE
CLASS="SCREEN"
>[git-buildpackage]
upstream-tag = v%(version)s
	</PRE
><P
>	  <TT
CLASS="REPLACEABLE"
><I
>version</I
></TT
> will be replaced with the upstream version number as read from
	  <TT
CLASS="FILENAME"
>debian/changelog</TT
>.
	</P
><P
>If you're using <SPAN
CLASS="PRODUCTNAME"
>pristine-tar</SPAN
> you can make <B
CLASS="COMMAND"
>git-buildpackage</B
> commit the tarball back to the
	  pristine-tar branch by using the <CODE
CLASS="OPTION"
>--git-pristine-tar-commit</CODE
> option.
	</P
></DIV
><BR
CLEAR="all"><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="GBP.IMPORT.UPSTREAM.GIT.TARBALL"
>Upstream tarballs</A
></H2
><P
>If you want to track upstream's git but continue to import the upstream tarballs,
	  e.g. to make sure the tarball uploaded
	  to <SPAN
CLASS="PRODUCTNAME"
>Debian</SPAN
> has the same checksum as upstream's you can use the <CODE
CLASS="OPTION"
>--upstream-vcs-tag</CODE
> option
	  when importing new tarballs with <B
CLASS="COMMAND"
>git-import-orig</B
>. Assuming you have the upstream source in your
	  repository with a tag <TT
CLASS="REPLACEABLE"
><I
>v0.0.1</I
></TT
> you can use:
	  <PRE
CLASS="SCREEN"
>	    <B
CLASS="COMMAND"
>git-import-orig</B
> --upstream-vcs-tag=v0.0.1 foo_0.0.1.orig.tar.gz
	  </PRE
>
	  to add upstream's tag as additional parent to the merge commit.
	  See <A
HREF="http://bugs.debian.org/664771"
TARGET="_top"
>#664771</A
> for more details.
	</P
></DIV
></DIV
></DIV
><TABLE
CLASS="navigation"
WIDTH="100%"
SUMMARY="Navigation footer"
CELLPADDING="2"
CELLSPACING="2"
><TR
VALIGN="middle"
><TD
ALIGN="left"
><A
ACCESSKEY="p"
HREF="gbp.intro.html"
><B
>&lt;&lt;&lt;&nbsp;Introduction</B
></A
></TD
><TD
ALIGN="right"
><A
ACCESSKEY="n"
HREF="gbp.building.html"
><B
>Building packages from the <SPAN
CLASS="PRODUCTNAME"
>Git</SPAN
> repository&nbsp;&gt;&gt;&gt;</B
></A
></TD
></TR
></TABLE
></BODY
></HTML
>