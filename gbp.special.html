<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Special use cases</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Building Packages with git-buildpackage suite"
HREF="index.html"><LINK
REL="UP"
TITLE="Building Debian Packages with git-buildpackage"
HREF="gbp.html"><LINK
REL="PREVIOUS"
TITLE="Configuration files"
HREF="gbp.cfgfile.html"><LINK
REL="NEXT"
TITLE="Command Reference"
HREF="man.reference.html"><STYLE
TYPE="text/css"
>.synopsis, .classsynopsis {
    background: #eeeeee;
    border: solid 1px #aaaaaa;
    padding: 0.5em;
}
.programlisting {
    background: #eeeeff;
    border: solid 1px #aaaaff;
    padding: 0.5em;
}
.variablelist {
    padding: 4px;
    margin-left: 3em;
}
.navigation {
    background: #ffeeee;
    border: solid 1px #ffaaaa;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}
.navigation a {
    color: #770000;
}
.navigation a:visited {
    color: #550000;
}
.navigation .title {
    font-size: 200%;
}</STYLE
></HEAD
><BODY
CLASS="CHAPTER"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><TABLE
WIDTH="100%"
CLASS="navigation"
SUMMARY="Navigation header"
CELLPADDING="2"
CELLSPACING="2"
><TR
VALIGN="middle"
><TD
><A
ACCESSKEY="p"
HREF="gbp.cfgfile.html"
><IMG
SRC="left.png"
WIDTH="16"
HEIGHT="16"
BORDER="0"
ALT="Prev"></A
></TD
><TD
><A
ACCESSKEY="u"
HREF="gbp.html"
><IMG
SRC="up.png"
WIDTH="16"
HEIGHT="16"
BORDER="0"
ALT="Up"></A
></TD
><TD
><A
ACCESSKEY="h"
HREF="index.html"
><IMG
SRC="home.png"
WIDTH="16"
HEIGHT="16"
BORDER="0"
ALT="Home"></A
></TD
><TH
WIDTH="100%"
align="center"
>Building Packages with git-buildpackage suite: Version: 0.7.0-tizen20151027</TH
><TD
><A
ACCESSKEY="n"
HREF="man.reference.html"
><IMG
SRC="right.png"
WIDTH="16"
HEIGHT="16"
BORDER="0"
ALT="Next"></A
></TD
></TR
></TABLE
><DIV
CLASS="CHAPTER"
><H1
><A
NAME="GBP.SPECIAL"
></A
>Special use cases</H1
><DIV
CLASS="TOC"
><DL
><DT
><B
>Table of Contents</B
></DT
><DT
><A
HREF="gbp.special.html#GBP.SPECIAL.DFSGFREE"
>Handling non-DFSG clean upstream sources</A
></DT
><DT
><A
HREF="gbp.special.html#GBP.SPECIAL.NMUS"
>Importing NMUs</A
></DT
><DT
><A
HREF="gbp.special.html#GBP.SPECIAL.PBUILDER"
>Building with <SPAN
CLASS="PRODUCTNAME"
>Cowbuilder</SPAN
></A
></DT
><DT
><A
HREF="gbp.special.html#GBP.SPECIAL.HACKING"
>Working on random packages</A
></DT
></DL
></DIV
><BR
CLEAR="all"><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GBP.SPECIAL.DFSGFREE"
>Handling non-DFSG clean upstream sources</A
></H1
><P
>If you have to handle non-DFSG clean upstream sources, you can use a
    different branch which you have to create once:
    </P
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>git</B
> branch dfsg_clean upstream
    </PRE
><P
>    This creates the <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>dfsg_clean</I
></SPAN
> branch from the tip of a
    branch called <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>upstream</I
></SPAN
>.  Then, when importing a new
    upstream version, you import the new version on the
    <CODE
CLASS="OPTION"
>upstream-branch</CODE
> (by default named
    <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>upstream</I
></SPAN
>) as usual and just don't merge to the
    <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>debian-branch</I
></SPAN
>  (by default named
    <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>master</I
></SPAN
>):
    </P
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>gbp&nbsp;import-orig</B
> --no-merge <TT
CLASS="FILENAME"
>/path/to/nondfsg-clean-package_10.4.orig.tar.gz</TT
>
<B
CLASS="COMMAND"
>git</B
> <CODE
CLASS="OPTION"
>tag</CODE
> 10.4
    </PRE
><P
>    After the import, you can switch to the <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>dfsg_clean</I
></SPAN
>
    branch and get the newly imported changes from the upstream branch:
    </P
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>git</B
> <CODE
CLASS="OPTION"
>checkout</CODE
> dfsg_clean
<B
CLASS="COMMAND"
>git</B
> <CODE
CLASS="OPTION"
>pull</CODE
> <TT
CLASS="FILENAME"
>.</TT
> upstream
    </PRE
><P
>Now make this checkout dfsg clean (preferably by a cleanup script), commit
    your changes and merge to your <CODE
CLASS="OPTION"
>debian-branch</CODE
>:</P
><PRE
CLASS="SCREEN"
>cleanup-script.sh
<B
CLASS="COMMAND"
>git</B
> commit -a -m "Make source dfsg clean"
<B
CLASS="COMMAND"
>git</B
> tag <TT
CLASS="REPLACEABLE"
><I
>10.4.dfsg</I
></TT
>
<B
CLASS="COMMAND"
>git</B
> checkout <TT
CLASS="REPLACEABLE"
><I
>master</I
></TT
>
<B
CLASS="COMMAND"
>git</B
> pull <TT
CLASS="REPLACEABLE"
><I
>.</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>dfsg_clean</I
></TT
>
    </PRE
></DIV
><BR
CLEAR="all"><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GBP.SPECIAL.NMUS"
>Importing NMUs</A
></H1
><P
>    First, create a branch that holds the NMUs from the tip of your
    <CODE
CLASS="OPTION"
>debian-branch</CODE
> (default is <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>master</I
></SPAN
>) once:
    </P
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>git</B
> <CODE
CLASS="OPTION"
>branch</CODE
> <TT
CLASS="REPLACEABLE"
><I
>nmu</I
></TT
> <TT
CLASS="REPLACEABLE"
><I
>master</I
></TT
>
    </PRE
><P
>    To import an NMU, change into the git repository and use <B
CLASS="COMMAND"
>gbp&nbsp;import-dsc</B
>:
    </P
><PRE
CLASS="SCREEN"
><B
CLASS="COMMAND"
>git</B
> checkout <TT
CLASS="REPLACEABLE"
><I
>master</I
></TT
>
<B
CLASS="COMMAND"
>gbp&nbsp;import-dsc</B
> <CODE
CLASS="OPTION"
>--debian-branch</CODE
>=<TT
CLASS="REPLACEABLE"
><I
>nmu</I
></TT
> <TT
CLASS="FILENAME"
>/path/to/package_1.0-1nmu0.dsc</TT
>
    </PRE
><P
>    This will import the NMU onto the branched named <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>nmu</I
></SPAN
>
    instead of the default <CODE
CLASS="OPTION"
>master</CODE
>. This method can also
    be used to import "old" releases into the <SPAN
CLASS="PRODUCTNAME"
>Git</SPAN
> repository when migrating
    to <SPAN
CLASS="PRODUCTNAME"
>Git</SPAN
> from another VCS.
    </P
></DIV
><BR
CLEAR="all"><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GBP.SPECIAL.PBUILDER"
>Building with <SPAN
CLASS="PRODUCTNAME"
>Cowbuilder</SPAN
></A
></H1
><P
>      <SPAN
CLASS="PRODUCTNAME"
>Cowbuilder</SPAN
> is nice tool to build Debian packages in a defined
      environment.  It makes sure all build-dependencies are specified
      correctly by building the package in a clean chroot. As its
      cousin <SPAN
CLASS="PRODUCTNAME"
>Pbuilder</SPAN
> it can be extended via hooks to (e.g. run
      autopkg tests) but doesn't need a tarball unpacked but uses copy
      on write tree to speed up the build.
    </P
><P
>      Since <SPAN
CLASS="PRODUCTNAME"
>Cowbuilder</SPAN
> uses different command line arguments than
      <SPAN
CLASS="PRODUCTNAME"
>Debuild</SPAN
> and <SPAN
CLASS="PRODUCTNAME"
>Dpkg-buildpackage</SPAN
>, we can't simply pass the
      options to run it on the command line. To simplifiy the
      integration we use a separate helper named <B
CLASS="COMMAND"
>git-pbuilder</B
>.
      <B
CLASS="COMMAND"
>gbp</B
> has it's own command line option for this:
    </P
><PRE
CLASS="PROGRAMLISTING"
>  <B
CLASS="COMMAND"
>gbp buildpackage</B
> <CODE
CLASS="OPTION"
>--git-pbuilder</CODE
></PRE
><P
>      This will set the build command to run <B
CLASS="COMMAND"
>git-pbuilder</B
> (which
      invokes <SPAN
CLASS="PRODUCTNAME"
>Cowbuilder</SPAN
> by default) and the clean command
      to <B
CLASS="COMMAND"
>/bin/true</B
>. It also activates the parsing
      of several <B
CLASS="COMMAND"
>git-pbuilder</B
> related options
      like <CODE
CLASS="OPTION"
>--git-dist</CODE
>, <CODE
CLASS="OPTION"
>--git-arch</CODE
> and
      <CODE
CLASS="OPTION"
>--git-pbuilder-options</CODE
>.
    </P
><P
>      We can make <B
CLASS="COMMAND"
>git-pbuilder</B
> usage the default by adding it to
      <TT
CLASS="FILENAME"
>~/.gbp.conf</TT
>:
    </P
><PRE
CLASS="PROGRAMLISTING"
>cat &lt;&lt;EOF &gt; <TT
CLASS="FILENAME"
>~/.gbp.conf</TT
>
[DEFAULT]
# We invoke cowbuilder via git-pbuilder. Arguments passed to <B
CLASS="COMMAND"
>gbp&nbsp;buildpackage</B
>
# will be passed to dpkg-buildpackage in the chroot
pbuilder = True
EOF
      </PRE
><P
>	<B
CLASS="COMMAND"
>git-pbuilder</B
> defaults to building a package for the
	<CODE
CLASS="ENVAR"
>sid</CODE
> distribution. If you want to build for another
	distribution, pass this in the <CODE
CLASS="OPTION"
>--git-dist</CODE
> option:

      <PRE
CLASS="PROGRAMLISTING"
><B
CLASS="COMMAND"
>gbp&nbsp;buildpackage</B
> --git-pbuilder --git-dist=jessie
      </PRE
>

	If you want to use <B
CLASS="COMMAND"
>debuild</B
> again (without
	modifying <TT
CLASS="FILENAME"
>~/.gbp.conf</TT
>), you can use:
      </P
><PRE
CLASS="PROGRAMLISTING"
><B
CLASS="COMMAND"
>gbp&nbsp;buildpackage</B
> --git-no-pbuilder
      </PRE
><P
>	In order for all of the above to work you have to create a
	base chroot first using <B
CLASS="COMMAND"
>git-pbuilder</B
>
      </P
><PRE
CLASS="PROGRAMLISTING"
><B
CLASS="COMMAND"
>git-pbuilder</B
> create
      </PRE
><P
>	This can later be updated using
      </P
><PRE
CLASS="PROGRAMLISTING"
><B
CLASS="COMMAND"
>git-pbuilder</B
> update
      </PRE
></DIV
><BR
CLEAR="all"><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="GBP.SPECIAL.HACKING"
>Working on random packages</A
></H1
><P
>    Whenever you need to work on an arbitrary <SPAN
CLASS="PRODUCTNAME"
>Debian</SPAN
> package, you can check it
    right into <SPAN
CLASS="PRODUCTNAME"
>Git</SPAN
> with one command:
<PRE
CLASS="PROGRAMLISTING"
>git-import-dsc --download <TT
CLASS="FILENAME"
>package</TT
>
cd <TT
CLASS="FILENAME"
>package</TT
>
git-branch debian</PRE
>
    </P
><P
>    This uses <B
CLASS="COMMAND"
>apt-get</B
> to download the source package,
    puts the orig tarball on the <CODE
CLASS="OPTION"
>upstream-branch</CODE
> and the
    <SPAN
CLASS="PRODUCTNAME"
>Debian</SPAN
> changes on the <CODE
CLASS="OPTION"
>debian-branch</CODE
> (by default
    <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>master</I
></SPAN
>). The second command
    creates a branch called <SPAN
CLASS="emphasis"
><I
CLASS="EMPHASIS"
>debian</I
></SPAN
>. Now you can easily
    modify the package, revert changes you made, create other branches for
    testing, see what changes you made, etc.  When finished, just do</P
><PRE
CLASS="PROGRAMLISTING"
>git-commit -a
git-diff debian --</PRE
><P
>&#13;    to get a nice patch that can be submitted to the <SPAN
CLASS="PRODUCTNAME"
>Debian</SPAN
> BTS. You can also
    fetch the source package from a URL:

<PRE
CLASS="PROGRAMLISTING"
>git-import-dsc --download <TT
CLASS="FILENAME"
>http://mentors.debian.net/debian/pool/main/i/ipsec-tools/ipsec-tools_0.7.3-9.dsc</TT
></PRE
>

   The import works incrementally; you can import new versions on top of
   already imported ones for e.g. easy review of changes.
    </P
></DIV
></DIV
><TABLE
CLASS="navigation"
WIDTH="100%"
SUMMARY="Navigation footer"
CELLPADDING="2"
CELLSPACING="2"
><TR
VALIGN="middle"
><TD
ALIGN="left"
><A
ACCESSKEY="p"
HREF="gbp.cfgfile.html"
><B
>&lt;&lt;&lt;&nbsp;Configuration files</B
></A
></TD
><TD
ALIGN="right"
><A
ACCESSKEY="n"
HREF="man.reference.html"
><B
>Command Reference&nbsp;&gt;&gt;&gt;</B
></A
></TD
></TR
></TABLE
></BODY
></HTML
>